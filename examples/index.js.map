{"version":3,"file":"index.js","sources":["../src/Color.ts","../src/Context.ts","../src/Program.ts","../src/VertexBuffer.ts","../src/IndexBuffer.ts","../src/Texture.ts","../src/examples/index.ts"],"sourcesContent":["export class Color {\n\n    static readonly TRANSPARENT = new Color(0.0, 0.0, 0.0, 0.0);\n    static readonly WHITE = new Color(1.0, 1.0, 1.0, 1.0);\n    static readonly BLACK = new Color(0.0, 0.0, 0.0, 1.0);\n    static readonly GRAY = new Color(0.5, 0.5, 0.5, 1.0);\n    static readonly DARK_GRAY = new Color(0.3, 0.3, 0.3, 1.0); // 深灰 \n    static readonly LIGHT_GRAY = new Color(0.7, 0.7, 0.7, 1.0); // 浅灰\n    static readonly RED = new Color(1.0, 0, 0, 1.0);\n    static readonly GREEN = new Color(0, 1.0, 0, 1.0);\n    static readonly BLUE = new Color(0, 0, 1.0, 1.0);\n    static readonly YELLOW = new Color(1.0, 1.0, 0, 1.0);\n    static readonly CYAN = new Color(0, 1.0, 1.0, 1.0); // 蓝绿\n\n    /**\n     *  颜色混合\n     * @static\n     * @param {Color} c1\n     * @param {Color} c2\n     * @param {number} ratio 0~1 之间的值\n     * @returns {Color}\n     */\n    public static Mix(c1: Color, c2: Color, ratio: number): Color {\n        let oneMinusR: number = 1 - ratio;\n        return new Color(c1.r * oneMinusR + c2.r * ratio,\n            c1.g * oneMinusR + c2.g * ratio,\n            c1.b * oneMinusR + c2.b * ratio,\n            c1.a * oneMinusR + c2.a * ratio);\n    }\n\n    public static fromHex(v: number): Color {\n        let inv255: number = 1 / 255;\n        return new Color(\n            ((v & 0xff000000) >>> 24) * inv255,\n            ((v & 0x00ff0000) >>> 16) * inv255,\n            ((v & 0x0000ff00) >>> 8) * inv255,\n            ((v & 0x000000ff)) * inv255\n        );\n    }\n\n    public static random(): Color {\n        return Color.fromHex(Math.random() * 0xffffffff);\n        // return new Color(Math.random(), Math.random(), Math.random(), Math.random());\n    }\n\n    /**\n     * WebGl需要值范围在 0 ~ 1 之间\n     * \n     * @type {number}\n     */\n    public r: number;\n    public g: number;\n    public b: number;\n    public a: number;\n\n    /**\n     * Creates an instance of Color.\n     * \n     * @param {number} [r=1] 0~1 之间\n     * @param {number} [g=1] 0~1 之间\n     * @param {number} [b=1] 0~1 之间\n     * @param {number} [a=1] 0~1 之间\n     */\n    constructor(r: number = 1, g: number = 1, b: number = 1, a: number = 1) {\n        this.r = r;\n        this.g = g;\n        this.b = b;\n        this.a = a;\n    }\n\n    public reset(r: number = 1, g: number = 1, b: number = 1, a: number = 1) {\n        this.r = r;\n        this.g = g;\n        this.b = b;\n        this.a = a;\n    }\n\n    public reset255(r: number = 255, g: number = 255, b: number = 255, a: number = 255) {\n        this.a255 = a;\n        this.r255 = r;\n        this.g255 = g;\n        this.b255 = b;\n    }\n\n    public get r255(): number {\n        return Math.round(this.r * 255);\n    }\n\n    public set r255(v: number) {\n        if (isNaN(v))\n            return;\n\n        this.r = v / 255;\n    }\n\n    public get g255(): number {\n        return Math.round(this.g * 255);\n    }\n\n    public set g255(v: number) {\n        if (isNaN(v))\n            return;\n\n        this.g = v / 255;\n    }\n\n    public get b255(): number {\n        return Math.round(this.b * 255);\n    }\n\n    public set b255(v: number) {\n        if (isNaN(v))\n            return;\n\n        this.b = v / 255;\n    }\n\n    public get a255(): number {\n        return Math.round(this.a * 255);\n    }\n\n    public set a255(v: number) {\n        if (isNaN(v))\n            return;\n\n        this.a = v / 255;\n    }\n\n    /**\n     *  设置 0xRRGGBBAA 格式\n     */\n    public set hex(v: number) {\n        this.r255 = ((v & 0xff000000) >>> 24);\n        this.g255 = ((v & 0x00ff0000) >>> 16);\n        this.b255 = ((v & 0x0000ff00) >>> 8);\n        this.a255 = ((v & 0x000000ff));\n    }\n\n    /**\n     * 返回 16进制数字 RRGGBBAA 格式\n     * \n     * @type {number}\n     */\n    public get hex(): number {\n        return (this.r255 << 24) | (this.g255 << 16) | (this.b255 << 8) | (this.a255);\n    }\n\n    public toFloat32Array(target?: Float32Array): Float32Array {\n        if (!target) {\n            target = new Float32Array(4);\n        }\n        target[0] = this.r;\n        target[1] = this.g;\n        target[2] = this.b;\n        target[3] = this.a;\n        return target;\n    }\n\n    public equal(c: Color): boolean {\n        let e = 0.001;\n        if (Math.abs(this.r - c.r) > e\n            || Math.abs(this.g - c.g) > e\n            || Math.abs(this.b - c.b) > e\n            || Math.abs(this.a - c.a) > e) {\n            return false;\n        }\n        return true;\n    }\n\n    public clone(): Color {\n        return new Color(this.r, this.g, this.b, this.a);\n    }\n\n    public toString() {\n        return `rgba(${this.r255}, ${this.g255}, ${this.b255}, ${this.a255})`;\n    }\n\n\n}\n","import { Color } from \"./Color\";\r\nimport { VertexBuffer } from \"./VertexBuffer\";\r\n\r\nexport class Context {\r\n\r\n    protected _drawCall: number = 0;\r\n    public _gl: WebGLRenderingContext;\r\n\r\n    constructor(ctx: WebGLRenderingContext) {\r\n        this._gl = ctx;\r\n        this.clearColor = Color.GRAY;\r\n    }\r\n\r\n    get width() {\r\n        return this._gl.drawingBufferWidth;\r\n    }\r\n\r\n    get height() {\r\n        return this._gl.drawingBufferHeight;\r\n    }\r\n    // set color\r\n    set clearColor(c: Color) {\r\n        this._gl.clearColor(c.r, c.g, c.b, c.a);\r\n    }\r\n\r\n    cullBackFace() {\r\n        let gl = this._gl;\r\n        gl.enable(gl.CULL_FACE);\r\n        gl.cullFace(gl.BACK);\r\n    }\r\n\r\n    clear(color: Color | null = null): void {\r\n        if (color)\r\n            this.clearColor = color;\r\n        this._gl.clear(this._gl.COLOR_BUFFER_BIT);\r\n        this._drawCall = 0;\r\n    }\r\n\r\n    // turn off the color channel\r\n    colorMask(r: boolean, g: boolean, b: boolean, a: boolean): void {\r\n        this._gl.colorMask(r, g, b, a);\r\n    }\r\n\r\n    flipY(boole: boolean = true) {\r\n        this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL, boole ? 1 : 0);\r\n    }\r\n\r\n    draw() {\r\n        //  gl.drawArrays or gl.drawElements\r\n    }\r\n\r\n    // 没有indexbuffer时调用\r\n    // @primitiveType: gl.POINTS, gl.LINES, gl.LINE_STRIP, gl.LINE_LOOP, gl.TRIANGLES, gl.TRIANGLE_STRIP, gl. TRIANGLE_FAN.\r\n    drawArrays(primitiveType: number, offset: number, count: number) {\r\n        this._gl.drawArrays(primitiveType, offset, count)\r\n    }\r\n    drawArraysPoints(offset: number, count: number) {\r\n        let gl = this._gl;\r\n        gl.drawArrays(gl.POINTS, offset, count);\r\n    }\r\n    drawArraysLines(offset: number, count: number) {\r\n        let gl = this._gl;\r\n        gl.drawArrays(gl.LINES, offset, count);\r\n    }\r\n    drawArraysLineStrip(offset: number, count: number) {\r\n        let gl = this._gl;\r\n        gl.drawArrays(gl.LINE_STRIP, offset, count);\r\n\r\n    }\r\n    drawArraysLineLoop(offset: number, count: number) {\r\n        let gl = this._gl;\r\n        gl.drawArrays(gl.LINE_LOOP, offset, count);\r\n\r\n    }\r\n    drawArraysTriangles(offset: number, count: number) {\r\n        let gl = this._gl;\r\n        gl.drawArrays(gl.TRIANGLES, offset, count)\r\n    }\r\n    drawArraysTriangleStrip(offset: number, count: number) {\r\n        let gl = this._gl;\r\n        gl.drawArrays(gl.TRIANGLE_STRIP, offset, count);\r\n    }\r\n    drawArraysTriangleFan(offset: number, count: number) {\r\n        let gl = this._gl;\r\n        gl.drawArrays(gl.TRIANGLE_FAN, offset, count);\r\n    }\r\n\r\n    drawElementsTriangle(count: number, offset: number = 0) {\r\n        let gl = this._gl;\r\n        gl.drawElements(gl.TRIANGLES, count, gl.UNSIGNED_SHORT, offset);\r\n    }\r\n\r\n    viewport(x: number, y: number, width: number, height: number) {\r\n        this._gl.viewport(x, y, width, height);\r\n    }\r\n\r\n    // 根据css大小设置 drawingbuffer大小 微信环境不支持！！！\r\n    adjustSize() {\r\n        let canvas = this._gl.canvas;\r\n        // Lookup the size the browser is displaying the canvas.\r\n        var displayWidth = canvas.clientWidth;\r\n        var displayHeight = canvas.clientHeight;\r\n\r\n        // Check if the canvas is not the same size.\r\n        if (canvas.width != displayWidth ||\r\n            canvas.height != displayHeight) {\r\n            if (__DEBUG__) {\r\n                console.log('context.adjustSize:', displayWidth, displayHeight);\r\n            }\r\n\r\n            // Make the canvas the same size\r\n            canvas.width = displayWidth;\r\n            canvas.height = displayHeight;\r\n            this._gl.viewport(0, 0, displayWidth, displayHeight);\r\n        }\r\n    }\r\n\r\n    adjustHDSize(realToCSSPixels: number = window.devicePixelRatio) {\r\n        let canvas = this._gl.canvas;\r\n\r\n        // Lookup the size the browser is displaying the canvas in CSS pixels\r\n        // and compute a size needed to make our drawingbuffer match it in\r\n        // device pixels.\r\n        var displayWidth = Math.floor(canvas.clientWidth * realToCSSPixels);\r\n        var displayHeight = Math.floor(canvas.clientHeight * realToCSSPixels);\r\n\r\n        // Check if the canvas is not the same size.\r\n        if (canvas.width !== displayWidth ||\r\n            canvas.height !== displayHeight) {\r\n\r\n            // Make the canvas the same size\r\n            canvas.width = displayWidth;\r\n            canvas.height = displayHeight;\r\n            this._gl.viewport(0, 0, displayWidth, displayHeight);\r\n        }\r\n    }\r\n\r\n    registMouseDown(fun: (x: number, y: number) => any) {\r\n        let gl = this._gl;\r\n        let canvas = gl.canvas;\r\n        canvas.onmousedown = (ev) => {\r\n            let x = ev.clientX;\r\n            let y = ev.clientY;\r\n            let rect = canvas.getBoundingClientRect();\r\n            fun(x - rect.left, y - rect.top);\r\n        }\r\n\r\n    }\r\n\r\n}","import { Context } from \"./Context\";\r\n\r\nexport class Program {\r\n\r\n    protected static BINDING: Program | null;\r\n\r\n    protected _ctx: Context;\r\n    protected _glProgram: WebGLProgram;\r\n\r\n    protected _vsSource: string;\r\n    protected _fsSource: string;\r\n\r\n    protected _uniformLocationMap: { [name: string]: WebGLUniformLocation } = {};\r\n    protected _attributeLocationMap: { [name: string]: number } = {};\r\n\r\n    constructor(ctx: Context, vsSource: string, fsSource: string) {\r\n\r\n        this._ctx = ctx;\r\n        this._vsSource = vsSource;\r\n        this._fsSource = fsSource;\r\n        this._glProgram = this._createGLProgram(vsSource, fsSource) as WebGLProgram;\r\n\r\n        //  gets all uniforms location\r\n        let gl: WebGLRenderingContext = this._ctx._gl;\r\n        const numUniforms = gl.getProgramParameter(this._glProgram, gl.ACTIVE_UNIFORMS);\r\n\r\n        let uniformInfo: WebGLActiveInfo;\r\n        for (let i = 0; i < numUniforms; i++) {\r\n            uniformInfo = gl.getActiveUniform(this._glProgram, i) as WebGLActiveInfo;\r\n            if (!uniformInfo) {\r\n                continue;\r\n            }\r\n\r\n            var name = uniformInfo.name;\r\n            // remove the array suffix.\r\n            if (name.substr(-3) === \"[0]\") {\r\n                name = name.substr(0, name.length - 3);\r\n            }\r\n\r\n            this._uniformLocationMap[name] = gl.getUniformLocation(this._glProgram, uniformInfo.name) as WebGLUniformLocation;\r\n            // uniformInfo.type  , uniformInfo.size\r\n            if (__DEBUG__) {\r\n                console.log('###Program uniforms: ###', uniformInfo.name, this._uniformLocationMap[name]);\r\n            }\r\n        }\r\n        let numAttribs: number = gl.getProgramParameter(this._glProgram, gl.ACTIVE_ATTRIBUTES);\r\n        let attribInfo: WebGLActiveInfo | null;\r\n        for (let i = 0; i < numAttribs; i++) {\r\n            attribInfo = gl.getActiveAttrib(this._glProgram, i);\r\n            if (!attribInfo) {\r\n                continue;\r\n            }\r\n            this._attributeLocationMap[attribInfo.name] = gl.getAttribLocation(this._glProgram, attribInfo.name);\r\n            if (__DEBUG__) {\r\n                console.log('###Program attributes: ###', attribInfo.name, this._attributeLocationMap[attribInfo.name]);\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    public getAttributeLocation(attribute: string) {\r\n        if (__DEBUG__) {\r\n            if (this._attributeLocationMap[attribute] === undefined)\r\n                console.error('getAttributeLocation error:', attribute);\r\n        }\r\n        return this._attributeLocationMap[attribute];\r\n    }\r\n\r\n    public getUniformLocation(uniform: string) {\r\n        if (__DEBUG__) {\r\n            if (this._uniformLocationMap[uniform] === undefined)\r\n                console.error('getUniformLocation error:', uniform);\r\n        }\r\n        return this._uniformLocationMap[uniform];\r\n    }\r\n\r\n    public uniformi(uniform: string, value: number) {\r\n        this.bind();\r\n        this._ctx._gl.uniform1i(this.getUniformLocation(uniform), value);\r\n    }\r\n\r\n    public uniform1f(uniform: string, value: number) {\r\n        this.bind();\r\n        this._ctx._gl.uniform1f(this.getUniformLocation(uniform), value);\r\n    }\r\n\r\n    /**\r\n     * uniform float u_kernel[9] => uniform1fv('u_kernel',[1,1,1,1,1,1,1,1,1])\r\n     * @param uniform \r\n     * @param value array\r\n     */\r\n    public uniform1fv(uniform: string, value: Float32List) {\r\n        this.bind();\r\n        this._ctx._gl.uniform1fv(this.getUniformLocation(uniform), value)\r\n    }\r\n\r\n    public uVec2(uniform: string, value: number, value2: number) {\r\n        this.bind();\r\n        this._ctx._gl.uniform2f(this.getUniformLocation(uniform), value, value2);\r\n    }\r\n\r\n    public uVec3(uniform: string, value: number, value2: number, value3: number) {\r\n        this.bind();\r\n        this._ctx._gl.uniform3f(this.getUniformLocation(uniform), value, value2, value3);\r\n    }\r\n\r\n    public uVec4(uniform: string, value: number, value2: number, value3: number, value4: number) {\r\n        this.bind();\r\n        this._ctx._gl.uniform4f(this.getUniformLocation(uniform), value, value2, value3, value4);\r\n    }\r\n\r\n    public uMat2(uniform: string, array4: Float32Array) {\r\n        this.bind();\r\n        this._ctx._gl.uniformMatrix2fv(this.getUniformLocation(uniform), false, array4);\r\n    }\r\n\r\n    /**\r\n     * upload 3x3 uniform\r\n     * uniform mat3 mvp;\r\n     * uniformMat3('mvp',new Float32Array([1,2,3,4,5,6,7,8,9]))\r\n     * @param uniform \r\n     * @param array9 \r\n     */\r\n    public uMat3(uniform: string, array9: Float32Array) {\r\n        this.bind();\r\n        this._ctx._gl.uniformMatrix3fv(this.getUniformLocation(uniform), false, array9);\r\n    }\r\n\r\n    public uMat4(uniform: string, array16: Float32Array) {\r\n        this.bind();\r\n        this._ctx._gl.uniformMatrix4fv(this.getUniformLocation(uniform), false, array16);\r\n    }\r\n\r\n    /**\r\n     * set texture unit n to the sampler\r\n     * @param uniform \r\n     * @param n \r\n     *  uniform sampler2D u_Sampler\r\n     *  ctx.uSampler('u_Sampler',0);\r\n     */\r\n    public uSampler2D(uniform: string, n: number) {\r\n        this.bind();\r\n        this._ctx._gl.uniform1i(this.getUniformLocation(uniform), n);\r\n    }\r\n\r\n    public bind(): Program {\r\n        if (Program.BINDING === this) {\r\n            return this;\r\n        }\r\n        this._ctx._gl.useProgram(this._glProgram);\r\n        Program.BINDING = this;\r\n        return this;\r\n    }\r\n\r\n    public unbind() {\r\n        if (Program.BINDING !== this)\r\n            return;\r\n        this._ctx._gl.useProgram(null);\r\n        Program.BINDING = null;\r\n    }\r\n\r\n    protected _createGLProgram(vsSource: string, fsSource: string): WebGLProgram {\r\n\r\n        let gl: WebGLRenderingContext = this._ctx._gl;\r\n        let vsShader: WebGLShader = gl.createShader(gl.VERTEX_SHADER) as WebGLShader;\r\n        gl.shaderSource(vsShader, vsSource);\r\n        gl.compileShader(vsShader);\r\n\r\n        if (__DEBUG__) {\r\n            if (!gl.getShaderParameter(vsShader, gl.COMPILE_STATUS)) {\r\n                console.error(`vertex shader compiling error occurred: ${gl.getShaderInfoLog(vsShader)}`);\r\n                gl.deleteShader(vsShader);\r\n            }\r\n        }\r\n\r\n        let fsShader: WebGLShader = gl.createShader(gl.FRAGMENT_SHADER) as WebGLShader;\r\n        gl.shaderSource(fsShader, fsSource);\r\n        gl.compileShader(fsShader);\r\n\r\n        if (__DEBUG__) {\r\n            // 立刻查询是否有编译错误\r\n            if (!gl.getShaderParameter(vsShader, gl.COMPILE_STATUS)) {\r\n                console.error(`fragment shader compiling error occurred: ${gl.getShaderInfoLog(vsShader)}`);\r\n                gl.deleteShader(fsShader);\r\n            }\r\n        }\r\n\r\n        let pm: WebGLProgram = gl.createProgram() as WebGLProgram;\r\n        gl.attachShader(pm, vsShader);\r\n        gl.attachShader(pm, fsShader);\r\n        gl.linkProgram(pm);\r\n\r\n        if (__DEBUG__) {\r\n            if (!gl.getProgramParameter(pm, gl.LINK_STATUS)) {\r\n                console.error(`Error linking shader: ${gl.getProgramInfoLog(pm)}`);\r\n                gl.deleteProgram(pm);\r\n            }\r\n        }\r\n        // clean up shaders\r\n        gl.deleteShader(vsShader);\r\n        gl.deleteShader(fsShader);\r\n\r\n        return pm;\r\n    }\r\n\r\n    dispose() {\r\n        this.unbind();\r\n        this._ctx._gl.deleteProgram(this._glProgram);\r\n    }\r\n\r\n}\r\n","import { Context } from \"./Context\";\r\n\r\nexport class VertexBuffer {\r\n\r\n    protected static BINDING: VertexBuffer | null;\r\n\r\n    protected _ctx: Context;\r\n    protected _glBuffer: WebGLBuffer;\r\n    protected _glUsage: number | undefined; // gl.DYNAMIC_DRAW | gl.STATIC_DRAW\r\n    // protected _data: Float32Array;\r\n    protected _attributes: Attribute[] = [];\r\n    protected _stride: number = 0 // 一个点的总 bytes 数\r\n\r\n    constructor(ctx: Context) {\r\n\r\n        this._ctx = ctx;\r\n        let gl = this._ctx._gl;\r\n        this._glBuffer = gl.createBuffer() as WebGLBuffer;\r\n    }\r\n\r\n    setData(data: Float32Array, dynamic: boolean = true): void {\r\n        this.bind();\r\n        let gl = this._ctx._gl;\r\n        this._glUsage = dynamic ? gl.DYNAMIC_DRAW : gl.STATIC_DRAW;\r\n        gl.bufferData(gl.ARRAY_BUFFER, data, this._glUsage)\r\n    }\r\n\r\n    /**\r\n     * \r\n     * @location: 调用 shader.getAttributeLocation(\"a_position\") 获得\r\n     * @numElements: float vec2 vec3 vec4 分别对应1,2,3,4\r\n     */\r\n    addAttribute(location: number, numElements: 1 | 2 | 3 | 4): VertexBuffer {\r\n        let item = new Attribute(location, numElements);\r\n        item.byteOffset = this._stride;\r\n        this._attributes.push(item);\r\n        this._stride += numElements * 4; // 1个 float = 4 bytes\r\n        return this;\r\n    }\r\n\r\n    public bindAttributes(): void {\r\n        this.bind()\r\n        let gl = this._ctx._gl;\r\n        let item: Attribute;\r\n        for (let i = 0; i < this._attributes.length; i++) {\r\n            item = this._attributes[i];\r\n            gl.enableVertexAttribArray(item.location);\r\n            gl.vertexAttribPointer(\r\n                item.location,\r\n                item.numElements,\r\n                gl.FLOAT, // item.type\r\n                false,\r\n                this._stride,\r\n                item.byteOffset\r\n            )\r\n        }\r\n    }\r\n\r\n    bind() {\r\n        if (VertexBuffer.BINDING === this)\r\n            return;\r\n        let gl = this._ctx._gl;\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._glBuffer);\r\n        VertexBuffer.BINDING = this;\r\n    }\r\n\r\n    unbind() {\r\n        if (VertexBuffer.BINDING !== this)\r\n            return;\r\n        let gl = this._ctx._gl;\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, null);\r\n        VertexBuffer.BINDING = null;\r\n    }\r\n\r\n    dispose() {\r\n        this.unbind();\r\n        this._ctx._gl.deleteBuffer(this._glBuffer);\r\n    }\r\n}\r\n\r\nclass Attribute {\r\n    byteOffset: number = 0; // 整个元素在开始的byte偏移\r\n    // type = gl.FLOAT\r\n    constructor(public location: number, public numElements: 1 | 2 | 3 | 4) { }\r\n}","import { Context } from \"./Context\";\r\n\r\nexport class IndexBuffer {\r\n\r\n    protected static BINDING: IndexBuffer | null;\r\n    protected _ctx: Context;\r\n    protected _glBuffer: WebGLBuffer;\r\n    protected _glUsage: number; // gl.DYNAMIC_DRAW | gl.STATIC_DRAW\r\n\r\n    constructor(ctx: Context, dynamic: boolean = false) {\r\n\r\n        this._ctx = ctx;\r\n        let gl = this._ctx._gl;\r\n        this._glBuffer = gl.createBuffer() as WebGLBuffer;\r\n        this._glUsage = dynamic ? gl.DYNAMIC_DRAW : gl.STATIC_DRAW;\r\n    }\r\n\r\n    setData(data: Uint16Array) {\r\n        this.bind();\r\n        let gl = this._ctx._gl;\r\n        gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, data, this._glUsage)\r\n\r\n    }\r\n\r\n    bind() {\r\n        if (IndexBuffer.BINDING === this)\r\n            return;\r\n        let gl = this._ctx._gl;\r\n        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this._glBuffer);\r\n        IndexBuffer.BINDING = this;\r\n    }\r\n\r\n    unbind() {\r\n        if (IndexBuffer.BINDING !== this)\r\n            return;\r\n        let gl = this._ctx._gl;\r\n        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null);\r\n        IndexBuffer.BINDING = null;\r\n    }\r\n\r\n    dispose() {\r\n        this.unbind();\r\n        this._ctx._gl.deleteBuffer(this._glBuffer);\r\n    }\r\n}","import { Context } from \"./Context\";\r\n// TODO: gl.TEXTURE_CUBE_MAP\r\nexport class Texture {\r\n\r\n    protected static BINDING: Texture | null;\r\n    protected _ctx: Context;\r\n    protected _glTexture: WebGLTexture;\r\n    protected _boundUnit: number = 0;\r\n    protected _useMipMaps: boolean = false;\r\n\r\n    constructor(ctx: Context, image?: HTMLImageElement, useMipMaps: boolean = false) {\r\n        this._ctx = ctx;\r\n        this._glTexture = ctx._gl.createTexture() as WebGLTexture;\r\n        this._useMipMaps = useMipMaps;\r\n        if (image)\r\n            this.image = image;\r\n    }\r\n\r\n    set image(image: HTMLImageElement) {\r\n        if (__DEBUG__) {\r\n            if (!this.isPowerOf2(image.width) || !this.isPowerOf2(image.height))\r\n                console.warn('image size is not power of 2');\r\n        }\r\n\r\n        this.bind(this._boundUnit);\r\n        let gl = this._ctx._gl;\r\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, image);\r\n\r\n        // To prevent texture wrappings\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n\r\n        if (this._useMipMaps && this.isPowerOf2(image.width) && this.isPowerOf2(image.height)) {\r\n\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR_MIPMAP_LINEAR);\r\n            gl.generateMipmap(gl.TEXTURE_2D);\r\n\r\n        } else {\r\n\r\n            // For pixel-graphics where you want the texture to look \"sharp\" do the following:\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n        }\r\n    }\r\n\r\n    bind(unit: number = 0) {\r\n        if (Texture.BINDING === this && unit === this._boundUnit)\r\n            return unit;\r\n        let gl = this._ctx._gl;\r\n        this._boundUnit = unit;\r\n        gl.activeTexture(gl.TEXTURE0 + unit);\r\n        gl.bindTexture(gl.TEXTURE_2D, this._glTexture);\r\n        Texture.BINDING = this;\r\n        return unit;\r\n    }\r\n\r\n    unbind() {\r\n        if (Texture.BINDING !== this)\r\n            return;\r\n        let gl = this._ctx._gl;\r\n        gl.activeTexture(gl.TEXTURE0 + this._boundUnit);\r\n        gl.bindTexture(gl.TEXTURE_2D, null);\r\n        Texture.BINDING = null;\r\n\r\n    }\r\n\r\n    /**\r\n     * \r\n     * 只有三个值合法\r\n     * \r\n        gl.MIRRORED_REPEAT\r\n        gl.CLAMP_TO_EDGE;\r\n        gl.REPEAT\r\n     */\r\n    setWraps(uWrap: number, vWrap: number): void {\r\n        this.bind(this._boundUnit);\r\n        let gl = this._ctx._gl;\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, uWrap);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, vWrap);\r\n    }\r\n\r\n    // NEAREST = choose 1 pixel from the biggest mip\r\n    // LINEAR = choose 4 pixels from the biggest mip and blend them\r\n    // NEAREST_MIPMAP_NEAREST = choose the best mip, then pick one pixel from that mip\r\n    // LINEAR_MIPMAP_NEAREST = choose the best mip, then blend 4 pixels from that mip\r\n    // NEAREST_MIPMAP_LINEAR = choose the best 2 mips, choose 1 pixel from each, blend them\r\n    // LINEAR_MIPMAP_LINEAR = choose the best 2 mips.choose 4 pixels from each, blend them\r\n    public setFilters(minFilter: number, magFilter: number): void {\r\n        let gl = this._ctx._gl;\r\n        this.bind(this._boundUnit);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, minFilter);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, magFilter);\r\n    }\r\n\r\n    protected isPowerOf2(n: number): boolean {\r\n        return (n & (n - 1)) === 0;\r\n    }\r\n}","import {VertexBuffer, Color, Context, Program } from \"../\";\r\n\r\nlet canvas: HTMLCanvasElement = document.getElementById('c') as HTMLCanvasElement;\r\nlet gl = canvas.getContext('webgl');\r\nif (gl) {\r\n\r\n    let ctx = new Context(gl);\r\n    ctx.clear(Color.BLUE);\r\n\r\n    let vs: string = `\r\n    attribute vec2 a_position;\r\n\r\n    uniform vec2 u_resolution;\r\n\r\n    void main() {\r\n\r\n        vec2 zeroToOne = a_position.xy / u_resolution;\r\n        vec2 zeroToTwo = zeroToOne.xy * 2.0;\r\n\r\n        vec2 clipSpace = zeroToTwo - 1.0;\r\n        gl_Position = vec4(clipSpace.xy * vec2(1,-1),0,1);\r\n    }`\r\n\r\n    let fs: string = `\r\n    precision mediump float;\r\n    void main(){\r\n        gl_FragColor = vec4(1,0,0.5,1);\r\n    }\r\n    `\r\n\r\n    let shader = new Program(ctx, vs, fs);\r\n    shader.bind();\r\n    shader.uVec2('u_resolution', canvas.width, canvas.height)\r\n\r\n    let posBuffer = new VertexBuffer(ctx);\r\n    posBuffer.addAttribute(shader.getAttributeLocation(\"a_position\"), 2);\r\n    posBuffer.setData(new Float32Array([\r\n        0, 0, \r\n        80, 20, \r\n        10, 30, \r\n        10, 30,\r\n        80, 20,\r\n        80, 30,]));\r\n\r\n    // render\r\n\r\n    ctx.adjustSize();\r\n    shader.bind();\r\n    posBuffer.bindAttributes();\r\n    ctx.drawArrays(gl.TRIANGLES, 0, 6);\r\n\r\n\r\n} else {\r\n    console.log('no webgl');\r\n}"],"names":["Color","Mix","c1","c2","ratio","oneMinusR","r","g","b","a","fromHex","v","inv255","random","Math","constructor","reset","reset255","a255","r255","g255","b255","round","isNaN","hex","toFloat32Array","target","Float32Array","equal","c","e","abs","clone","toString","Context","ctx","_gl","clearColor","GRAY","width","drawingBufferWidth","height","drawingBufferHeight","cullBackFace","gl","enable","CULL_FACE","cullFace","BACK","clear","color","COLOR_BUFFER_BIT","_drawCall","colorMask","flipY","boole","pixelStorei","UNPACK_FLIP_Y_WEBGL","draw","drawArrays","primitiveType","offset","count","drawArraysPoints","POINTS","drawArraysLines","LINES","drawArraysLineStrip","LINE_STRIP","drawArraysLineLoop","LINE_LOOP","drawArraysTriangles","TRIANGLES","drawArraysTriangleStrip","TRIANGLE_STRIP","drawArraysTriangleFan","TRIANGLE_FAN","drawElementsTriangle","drawElements","UNSIGNED_SHORT","viewport","x","y","adjustSize","canvas","displayWidth","clientWidth","displayHeight","clientHeight","adjustHDSize","realToCSSPixels","window","devicePixelRatio","floor","registMouseDown","fun","onmousedown","ev","clientX","clientY","rect","getBoundingClientRect","left","top","Program","vsSource","fsSource","_ctx","_vsSource","_fsSource","_glProgram","_createGLProgram","numUniforms","getProgramParameter","ACTIVE_UNIFORMS","uniformInfo","i","getActiveUniform","name","substr","length","_uniformLocationMap","getUniformLocation","numAttribs","ACTIVE_ATTRIBUTES","attribInfo","getActiveAttrib","_attributeLocationMap","getAttribLocation","getAttributeLocation","attribute","uniform","uniformi","value","bind","uniform1i","uniform1f","uniform1fv","uVec2","value2","uniform2f","uVec3","value3","uniform3f","uVec4","value4","uniform4f","uMat2","array4","uniformMatrix2fv","uMat3","array9","uniformMatrix3fv","uMat4","array16","uniformMatrix4fv","uSampler2D","n","BINDING","useProgram","unbind","vsShader","createShader","VERTEX_SHADER","shaderSource","compileShader","fsShader","FRAGMENT_SHADER","pm","createProgram","attachShader","linkProgram","deleteShader","dispose","deleteProgram","VertexBuffer","_glBuffer","createBuffer","setData","data","dynamic","_glUsage","DYNAMIC_DRAW","STATIC_DRAW","bufferData","ARRAY_BUFFER","addAttribute","location","numElements","item","Attribute","byteOffset","_stride","_attributes","push","bindAttributes","enableVertexAttribArray","vertexAttribPointer","FLOAT","bindBuffer","deleteBuffer","IndexBuffer","ELEMENT_ARRAY_BUFFER","Texture","image","useMipMaps","_glTexture","createTexture","_useMipMaps","_boundUnit","texImage2D","TEXTURE_2D","RGBA","UNSIGNED_BYTE","texParameteri","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","isPowerOf2","TEXTURE_MAG_FILTER","LINEAR","TEXTURE_MIN_FILTER","LINEAR_MIPMAP_LINEAR","generateMipmap","NEAREST","unit","activeTexture","TEXTURE0","bindTexture","setWraps","uWrap","vWrap","setFilters","minFilter","magFilter","document","getElementById","getContext","BLUE","vs","fs","shader","posBuffer","console","log"],"mappings":"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"}